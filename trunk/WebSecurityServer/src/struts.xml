<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE struts PUBLIC
	"-//Apache Software Foundation//DTD Struts Configuration 2.3//EN"
	"http://struts.apache.org/dtds/struts-2.3.dtd">
<struts>
	<constant name="struts.i18n.encoding" value="UTF-8"></constant>
	
	<constant name="struts.objectFactory.spring.useClassCache" value="true"></constant>
	<constant name="struts.locale" value="zh_CN"></constant>
	<constant name="struts.configuration.xmlreload" value="true"/>
	<constant name="struts.devMode" value="true"/>
	
	<!-- set user common-fileUpload parser  -->
	<constant name="struts.multipart.parser" value="jakarta"></constant>
	<!-- set one time of file upload size  -->
	<constant name="struts.multipart.maxSize" value="104857600"/>
	<!-- 
	<constant name="struts.objectFactory" value="spring "></constant>
	 -->

	<package name="default" namespace="/" extends="json-default">

		<interceptors>
		    <interceptor-stack name="jsonDefaultStack">
		       <interceptor-ref name="json"/>
		       <interceptor-ref name="defaultStack"/>
		 	</interceptor-stack>
		</interceptors>
    
		<default-interceptor-ref name="jsonDefaultStack"/>

		<!-- 全局结果 -->
		<global-results>
			<result name="login">/login.jsp</result>
			<result name="error">/page/error.jsp</result>
		</global-results>
		
		<!-- 文件上传和下载控制器 ，class 引用spring 的注入 -->
	        <action name="*Food_Picture" class="com.pitaya.bookingnow.action.Food_PictureAction" method="{1}Food_Picture">
				
	        	
				<result name="uploadSuccess" type="redirectAction">
				    showMyFile.action
				</result>
				
				<result name="getSmallImageSuccess" type="stream">
					<param name="inputName">smallImageFood_Picture</param>
					<param name="bufferSize">4096</param>
				</result>
				
				<result name="getLargeImageSuccess" type="stream">
					<param name="inputName">largeImageFood_Picture</param>
					<param name="bufferSize">4096</param>
				</result>
				
				
				<result name="downloadSuccess" type="stream">
				
					<!-- 下载文件的类型 ,这里表示无限制
					<param name="contentType">application/octet-stream;charset=GBK</param>
					-->
					<param name="contentType">application/octet-stream;charset="iso-8859-1"</param>
					
					<!-- 下载文件的长度 -->
					<param name="contentLength">${realDownloadFile.length()}</param>
					
					<!-- inputName 流对象名 —— 比如这里写targetFile，它就会自动去找Action中的getTargetFile方法 -->
					<param name="inputName">downloadFileStream</param>
					
					<!-- contentDisposition 使用经过转码的文件名作为下载文件名 —— 默认
					格式是attachment;filename="${fileName}",将调用该Action中的getDownloadFileName方法。 -->
					<param name="contentDisposition">attachment;filename="${downloadFileName}"</param>
					
					<!-- 设置下载缓冲大小 -->
					<param name="bufferSize">4096</param>
				</result>
					
	        </action>
	    <action name="j_spring_security_check" class="com.pitaya.bookingnow.action.UserAction" method="spring_security_loginUser">
			<result name="loginSuccess" type="json">
				<param name="root">loginUser</param>
	        </result>
	        
			<result name="loginFail" type="json">
				/Page/Common/error.jsp
	        </result>
	    </action>

		<action name="*User" class="com.pitaya.bookingnow.action.UserAction" method="{1}User">
			<result name="loginSuccess" type="json">
				<param name="root">loginUser</param>
	        </result>
	        
			<result name="loginFail" type="json">
				/Page/Common/error.jsp
	        </result>

			
	        
			<result name="findFail" type="dispatcher">
				/Page/error.jsp
	        </result>

			<result name="findSuccess" type="dispatcher">
				/Page/success.jsp
	        </result>
	        
	        <result name="registerSuccess" type="dispatcher">
				/Page/error.jsp
	        </result>

			<result name="registerFail" type="dispatcher">
				/Page/success.jsp
	        </result>
	        
	        <result name="updateSuccess" type="dispatcher">
				/Page/error.jsp
	        </result>

			<result name="updateFail" type="dispatcher">
				/Page/success.jsp
	        </result>
	        
	        <result name="removeSuccess" type="dispatcher">
				/Page/error.jsp
	        </result>

			<result name="removeFail" type="dispatcher">
				/Page/success.jsp
	        </result>
		</action>
		

		<action name="*Order" class="com.pitaya.bookingnow.action.OrderAction" method="{1}Order">

			<result name="searchSuccess" type="json">
				<param name="root">matchedOrders</param>
	        </result>
	        
	        <result name="submitWaitingSuccess" type="json">
	        	<param name="excludeNullProperties">true</param>  
				<param name="includeProperties">result</param>
	        </result>
	        
	        <result name="submitNewSuccess" type="json">
	        	<param name="excludeNullProperties">true</param>  
				<param name="includeProperties">result</param>
	        </result>
	        
	        <result name="updateConfirmedNewSuccess" type="json">
	        	<param name="excludeNullProperties">true</param>  
				<param name="includeProperties">result</param>
	        </result>
	        
	        <result name="Success" type="json">
				<param name="includeProperties">result, detail</param>  
	        </result>
	        
	        <result name="Fail" type="json">
				<param name="includeProperties">result, detail</param>  
	        </result>
	        
		</action>
		
		<action name="*Food" class="com.pitaya.bookingnow.action.FoodAction" method="{1}Food">
	        
	        <result name="updateMenuSuccess" type="json">
	        	<param name="excludeNullProperties">true</param>
				<param name="root">newMenuFood</param>
	        </result>
	        
	        <result name="Fail" type="json">
				<param name="includeProperties">result, detail</param>  
	        </result>
	        
		</action>

	</package>
</struts>   