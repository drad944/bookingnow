<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>order management</title>

	<link rel="stylesheet" type="text/css" href="../../css/head.css">
	<link rel="stylesheet" href="../../css/jqwidgets/styles/jqx.base.css" type="text/css" />
	
	<script type="text/javascript" src="../../js/jquery-1.10.2.js"></script>
	<script type="text/javascript" src="../../js/AppUtil.js"></script>
	
    <script type="text/javascript" src="../../js/jqwidgets/jqxcore.js"></script>
    <script type="text/javascript" src="../../js/jqwidgets/jqxdata.js"></script>
    
     
    <script type="text/javascript" src="../../js/jqwidgets/jqxbuttons.js"></script>
    <script type="text/javascript" src="../../js/jqwidgets/jqxdropdownlist.js"></script>
    <script type="text/javascript" src="../../js/jqwidgets/jqxlistbox.js"></script>
    <script type="text/javascript" src="../../js/jqwidgets/jqxscrollbar.js"></script>
    <script type="text/javascript" src="../../js/jqwidgets/jqxmenu.js"></script>
    <script type="text/javascript" src="../../js/jqwidgets/jqxgrid.js"></script>
    <script type="text/javascript" src="../../js/jqwidgets/jqxgrid.filter.js"></script>
    <script type="text/javascript" src="../../js/jqwidgets/jqxgrid.sort.js"></script>
    <script type="text/javascript" src="../../js/jqwidgets/jqxgrid.pager.js"></script>
    <script type="text/javascript" src="../../js/jqwidgets/jqxgrid.selection.js"></script> 
    <script type="text/javascript" src="../../js/jqwidgets/jqxgrid.columnsresize.js"></script>
    <script type="text/javascript" src="../../js/jqwidgets/jqxgrid.columnsreorder.js"></script> 
    
     <script type="text/javascript" src="../../js/jqwidgets/jqxnumberinput.js"></script>
    <script type="text/javascript" src="../../js/jqwidgets/jqxwindow.js"></script>
    <script type="text/javascript" src="../../js/jqwidgets/jqxinput.js"></script>
    
    <script type="text/javascript" src="../../js/jqwidgets/gettheme.js"></script>
    <script type="text/javascript">
         $(document).ready(function () {
         		$.post("searchOrder.action", 
		    			{"order.enabled": true}, 
		    			function(matchedOrders){
	if(matchedOrders != null && matchedOrders.result != null){
		orders = matchedOrders.result;
	}
	
	
	var orderSize = orders.length;
	var orderData = {};
	
	var columns = {};
	
	var datafields = {};
	for(var i = 0;i < orderSize; i++) {
		order = orders[i];
		if(i==0) {
			var j=0;
			
			for(var item in order) {
				var datafield = {};
				var column = {};
				
				if(item == "id"){
					datafield["type"] = "number";
					column["text"] = "Id";
					
				}else if(item == "allowance") {
					datafield["type"] = "number";
					column["text"] = "Allowance";
					
				}else if(item == "customer_count") {
					datafield["type"] = "number";
					column["text"] = "Customer_count";
					
				}else if(item == "customer_id") {
					datafield["type"] = "number";
					column["text"] = "Customer_id";
					
				}else if(item == "modifyTime") {
					datafield["type"] = "number";
					column["text"] = "ModifyTime";
					
				}else if(item == "prePay") {
					datafield["type"] = "number";
					column["text"] = "PrePay";
					
				}else if(item == "status") {
					datafield["type"] = "number";
					column["text"] = "Status";
					
				}else if(item == "submit_time") {
					datafield["type"] = "number";
					column["text"] = "Submit_time";
					
				}else if(item == "total_price") {
					datafield["type"] = "number";
					column["text"] = "Total_price";
					
				}else if(item == "user_id") {
					datafield["type"] = "number";
					column["text"] = "User_id";
					
				}else if(item == "enabled") {
					datafield["type"] = "boolean";
					column["text"] = "Enabled";
					
				}else if(item == "customer" || item == "food_details" ||item == "table_details" ||item == "user"){
					//do nothing
				}else {
					datafield["type"] = "string";
					column["text"] = "XX";
				}
				
				if(item == "customer" || item == "food_details" ||item == "table_details" ||item == "user"){
					
				}else {
					column["datafield"] = item;
					if(item == "id") {
						column["width"] = "50";
					}
					
					columns[j] = column;
					
					datafields[j] = datafield;
					j++;
				}
			}
		}
		
		var rowData = {};
		for(var item in order) {
			if(item == "customer" || item == "food_details" ||item == "table_details" ||item == "user"){
					
			}else {
				rowData[item] = order[item];
			}
			
		}
		
		orderData[i] = rowData;
	}
	
         
            var theme = getDemoTheme();
            
            var source =
            {
                localdata: orderData,
                datatype: "local",
                datafields:datafields,
                addrow: function (rowid, rowdata, position, commit) {
                    // synchronize with the server - send insert command
                    // call commit with parameter true if the synchronization with the server is successful 
                    //and with parameter false if the synchronization failed.
                    // you can pass additional argument to the commit callback which represents the new ID if it is generated from a DB.
                    commit(true);
                },
                deleterow: function (rowid, commit) {
                    // synchronize with the server - send delete command
                    // call commit with parameter true if the synchronization with the server is successful 
                    //and with parameter false if the synchronization failed.
                    commit(true);
                },
                updaterow: function (rowid, newdata, commit) {
                    // synchronize with the server - send update command
                    // call commit with parameter true if the synchronization with the server is successful 
                    // and with parameter false if the synchronization failed.
                    commit(true);
                }
            };
            var dataAdapter = new $.jqx.dataAdapter(source);
            // initialize jqxGrid
            $("#orderDataGrid").jqxGrid(
            {
                width: 1000,
                height: 350,
                source: dataAdapter,
                theme: theme,
                columns: columns,
                selectionmode: 'multiplerowsextended',
                sortable: true,
                pageable: true,
                autoheight: true,
                columnsresize: true,
              //  columnsreorder: true,
            });
            $("#addOrderRowButton").jqxButton({ theme: theme });
            $("#addmultiplerowsbutton").jqxButton({ theme: theme });
            $("#deleteOrderRowButton").jqxButton({ theme: theme });
            $("#updateOrderRowButton").jqxButton({ theme: theme });
            // update row.
            $("#updateOrderRowButton").on('click', function () {
                var datarow = generaterow();
                var selectedrowindex = $("#orderDataGrid").jqxGrid('getselectedrowindex');
                var rowscount = $("#orderDataGrid").jqxGrid('getdatainformation').rowscount;
                if (selectedrowindex >= 0 && selectedrowindex < rowscount) {
                    var id = $("#orderDataGrid").jqxGrid('getrowid', selectedrowindex);
                    var commit = $("#orderDataGrid").jqxGrid('updaterow', id, datarow);
                    $("#orderDataGrid").jqxGrid('ensurerowvisible', selectedrowindex);
                }
            });
            // create new row.
            $("#addOrderRowButton").on('click', function () {
                var datarow = generaterow();
                var commit = $("#orderDataGrid").jqxGrid('addrow', null, datarow);
            });
            // create new rows.
            $("#addmultiplerowsbutton").on('click', function () {
                $("#orderDataGrid").jqxGrid('beginupdate');
                for (var i = 0; i < 10; i++) {
                    var datarow = generaterow();
                    var commit = $("#orderDataGrid").jqxGrid('addrow', null, datarow);
                }
                $("#orderDataGrid").jqxGrid('endupdate');
            });
            // delete row.
            $("#deleteOrderRowButton").on('click', function () {
                var selectedrowindex = $("#orderDataGrid").jqxGrid('getselectedrowindex');
                var rowscount = $("#orderDataGrid").jqxGrid('getdatainformation').rowscount;
                if (selectedrowindex >= 0 && selectedrowindex < rowscount) {
                    var id = $("#orderDataGrid").jqxGrid('getrowid', selectedrowindex);
                    var commit = $("#orderDataGrid").jqxGrid('deleterow', id);
                }
            });
        });
    });
    </script>
</head>
	
<body>
	<div id="content">
		<div id='jqxWidget' style="font-size: 13px; font-family: Verdana; float: left;">
			<div id="J_Nav" class="main-nav">
				<ul>
					<li class="J_nav_1">
						<div>
		                	<input id="addOrderRowButton" type="button" value="Add New Row" />
		            	</div>
					</li>
					
					<li class="J_nav_1">
						<div>
		                	<input id="updateOrderRowButton" type="button" value="Update Selected Row" />
		            	</div>
					</li>
					
					<li class="J_nav_1">
						<div>
		                	<input id="deleteOrderRowButton" type="button" value="Delete Selected Row" />
		            	</div>
					</li>
					
				</ul>
			</div>
        	<div style="float: left;" id="orderDataGrid"></div>
    	</div>
		
	</div>
	
</body>
</html>